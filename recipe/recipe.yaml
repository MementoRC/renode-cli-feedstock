context:
  name: renode-cli
  version: "1.15.3"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  - url: https://github.com/renode/renode/releases/download/v${{ version }}/renode_${{ version }}_source.tar.xz
    sha256: 40c50afe8db86a9c63f4a86b93116a6babd43bf241cfaac47b2c0d2cbc2b15a8
    patches:
      - patches/update-cores.template_NET.csproj.patch

build:
  number: 1
  skip: ppc64le

requirements:
  build:
    - dotnet >=8.0.302
    - nuget-license
    - if: unix
      then:
        - sed
        - bash
      else:
        - m2-bash
        - m2-coreutils
        - m2-findutils
        - m2-sed
  host:
    - renode-cores ==${{ version }}
  run:
    - dotnet >=8.0.302

tests:
  - package_contents:
      bin:
        - renode
      files:
        - ${{ "Library/" if win }}share/renode-cli/scripts/monitor.py
        - ${{ "Library/" if win }}share/renode-cli/platforms/cpus/cortex-a9.repl
        - ${{ "Library/" if win }}share/renode-cli/tools/sel4_extensions/seL4Extensions.cs
  - script:
      - if: target_platform == "linux-aarch64"
        then:
          - DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=1 renode --help
          - DOTNET_SYSTEM_GLOBALIZATION_INVARIANT=1 LOCAL_TEST_PREFIX=./test-bundle test-bundle/${{ "Library/" if win }}bin/renode-test test-bundle/${{ "Library/" if win }}share/renode-cli/tests/unit-tests
        else:
          - renode --help
          - LOCAL_TEST_PREFIX=./test-bundle test-bundle/${{ "Library/" if win }}bin/renode-test test-bundle/${{ "Library/" if win }}share/renode-cli/tests/unit-tests
    files:
      source:
        - test-bundle/

about:
  homepage: https://github.com/renode/renode
  summary: "Antmicro's open source simulation and virtual development framework for complex embedded systems"
  description: |
    Renode was created by Antmicro as a virtual development tool for multi-node
    embedded networks (both wired and wireless) and is intended to enable a scalable
    workflow for creating effective, tested and secure IoT systems.

    With Renode, developing, testing, debugging and simulating unmodified software
    for IoT devices is fast, cost-effective and reliable.
  license: MIT
  license_file:
    - LICENSE
    - license-files/
  documentation: https://renode.io/
  repository: https://github.com/renode/renode

extra:
  recipe-maintainers:
    - MementoRC
    - danielnachun
